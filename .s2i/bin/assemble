#!/bin/bash

#PHP Home
NGINX_HOME=/opt/app-root

# Source code provided to STI is at /tmp/src/
LOCAL_SOURCE_DIR=/tmp/src

# Resulting ZIP files will be deployed to /opt/app-root/src
DEPLOY_DIR=$NGINX_HOME/src

#/opt/app-root/src

function copy_artifacts() {
  if [ -d $LOCAL_SOURCE_DIR ]; then
    echo "Copying all WAR, EAR, JAR and ZIP artifacts from $LOCAL_SOURCE_DIR directory into $DEPLOY_DIR for later deployment..."
    cp -v $LOCAL_SOURCE_DIR/*.zip $LOCAL_SOURCE_DIR/*.jar $LOCAL_SOURCE_DIR/*.war $LOCAL_SOURCE_DIR/*.ear $DEPLOY_DIR 2> /dev/null
   	unzip $DEPLOY_DIR/*.zip -d $DEPLOY_DIR 2> /dev/null
    mv $DEPLOY_DIR/dist/*  $DEPLOY_DIR/.     
	  rm -rf $DEPLOY_DIR/*.zip
  fi
}

# Copy (probably binary) artifacts from the /tmp/src/
# directory to the $NGINX_HOME/src
# directory for later deployment
copy_artifacts "deployments"

exit 0